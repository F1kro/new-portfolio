---
import BaseLayout from '../layouts/BaseLayout.astro';
import Editor from '../components/Admin/Editor';
---

<BaseLayout title="Admin | Tambah Proyek">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold text-white mb-8">Tambah Proyek Baru</h1>
    
    <div class="space-y-4">
      <input id="title" type="text" placeholder="Judul Proyek" class="w-full bg-white/5 border border-white/10 p-3 rounded-lg outline-none focus:border-blue-500 text-white" />
      
      <input id="tags" type="text" placeholder="Tags (pisah dengan koma: Astro, Laravel)" class="w-full bg-white/5 border border-white/10 p-3 rounded-lg outline-none focus:border-blue-500 text-white" />

      <div class="bg-white/5 rounded-lg p-2 border border-white/10">
        <p class="text-xs text-gray-500 mb-2 px-2 uppercase">Konten Proyek</p>
        <Editor client:load content="" onChange={(html) => window.editorContent = html} />
      </div>

      <button id="saveBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all">
        Publish Proyek
      </button>
    </div>
  </div>

  <script>
    const saveBtn = document.getElementById('saveBtn');
    saveBtn.addEventListener('click', async () => {
      const title = (document.getElementById('title') as HTMLInputElement).value;
      const tags = (document.getElementById('tags') as HTMLInputElement).value.split(',').map(t => t.trim());
      const content = (window as any).editorContent;

      const res = await fetch('/api/projects', {
        method: 'POST',
        body: JSON.stringify({ title, tags, content })
      });

      if (res.ok) {
        alert('Proyek berhasil disimpan!');
        window.location.href = '/';
      } else {
        alert('Gagal simpan data');
      }
    });
  </script>
</BaseLayout>